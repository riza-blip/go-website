{{define "event_view.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{.Event.Title}} - EventHub</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--primary:#6366f1;}*{font-family:'Inter',sans-serif;}body{background:#f8fafc;}
.navbar{background:rgba(15,23,42,.95);}
.navbar-brand{font-weight:800;color:#fff!important;}
.navbar-brand span{color:#818cf8;}
.navbar .nav-link{color:rgba(255,255,255,.8)!important;}
.hero-img{width:100%;height:400px;object-fit:cover;border-radius:16px;}
.hero-no-img{width:100%;height:400px;background:linear-gradient(135deg,#6366f1,#c084fc);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:5rem;color:#fff;}
.info-card{background:#fff;border-radius:14px;border:1px solid #e2e8f0;padding:1.5rem;}
.detail-row{display:flex;align-items:center;gap:.75rem;padding:.75rem 0;border-bottom:1px solid #f8fafc;}
.detail-row:last-child{border-bottom:none;}
.detail-icon{width:36px;height:36px;border-radius:8px;background:#ede9fe;color:#6366f1;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.booking-form{background:#fff;border-radius:14px;border:1px solid #e2e8f0;padding:1.5rem;position:sticky;top:1rem;}
.review-card{background:#fff;border-radius:12px;border:1px solid #e2e8f0;padding:1rem;}
.stars .bi-star-fill{color:#f59e0b;}
.stars .bi-star{color:#d1d5db;}
.badge-cat{background:#ede9fe;color:#6d28d9;font-size:.8rem;padding:.3rem .9rem;border-radius:50px;}
.btn-primary{background:var(--primary);border-color:var(--primary);}
.form-control{border-radius:8px;border:1.5px solid #e2e8f0;}
.form-control:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(99,102,241,.15);}
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <a class="navbar-brand" href="/"><i class="bi bi-calendar-event me-2"></i>Event<span>Hub</span></a>
    <div class="d-flex gap-2">
      <a href="/events" class="btn btn-outline-light btn-sm"><i class="bi bi-arrow-left me-1"></i>Events</a>
      {{if .Session}}
      <a href="/{{.Session.Role}}/dashboard" class="btn btn-outline-light btn-sm">Dashboard</a>
      <a href="/logout" class="btn btn-primary btn-sm">Logout</a>
      {{else}}
      <a href="/login" class="btn btn-outline-light btn-sm">Login</a>
      {{end}}
    </div>
  </div>
</nav>

<div class="container py-4">
  <div class="row g-4">
    <div class="col-lg-8">
     
      <div class="d-flex flex-wrap gap-2 mb-3">
        <span class="badge-cat">{{.Event.Category}}</span>
        {{if .Event.IsFeatured}}<span class="badge bg-warning text-dark">⭐ Featured</span>{{end}}
      </div>
      <h2 class="fw-800 mb-2">{{.Event.Title}}</h2>
      <div class="text-muted mb-4">by <strong>{{.Event.OrganizerName}}</strong></div>

      <!-- Event Details -->
      <div class="info-card mb-4">
        <h6 class="fw-700 mb-3">Event Details</h6>
        <div class="detail-row">
          <div class="detail-icon"><i class="bi bi-calendar3"></i></div>
          <div><div class="fw-500">Date</div><div class="text-muted small">{{formatDate .Event.EventDate}} {{if .Event.EventTime}}at {{.Event.EventTime}}{{end}}</div></div>
        </div>
        <div class="detail-row">
          <div class="detail-icon"><i class="bi bi-geo-alt"></i></div>
          <div><div class="fw-500">Venue</div><div class="text-muted small">{{.Event.Venue}}{{if .Event.Location}}, {{.Event.Location}}{{end}}</div></div>
        </div>
        <div class="detail-row">
          <div class="detail-icon"><i class="bi bi-people"></i></div>
          <div>
            <div class="fw-500">Attendance</div>
            <div class="text-muted small">{{.Event.BookingCount}} booked{{if gt .Event.Capacity 0}} / {{.Event.Capacity}} capacity{{end}}</div>
            {{if gt .Event.Capacity 0}}
            <div class="progress mt-1" style="height:6px;width:200px;">
              

              
            </div>
            {{end}}
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-icon"><i class="bi bi-currency-dollar"></i></div>
          <div><div class="fw-500">Price</div><div class="text-muted small">{{formatPrice .Event.Price}} per ticket</div></div>
        </div>
      </div>

      <!-- Description -->
      <div class="info-card mb-4">
        <h6 class="fw-700 mb-3">About This Event</h6>
        <p class="text-muted" style="white-space:pre-line;">{{.Event.Description}}</p>
      </div>

      <!-- Reviews -->
      <div class="info-card">
        <h6 class="fw-700 mb-3"><i class="bi bi-star me-2 text-warning"></i>Reviews ({{len .Reviews}})</h6>
        {{if .Reviews}}
        <div class="row g-3 mb-4">
          {{range .Reviews}}
          <div class="col-md-6">
            <div class="review-card">
              <div class="d-flex justify-content-between mb-2">
                <strong class="small">{{.UserName}}</strong>
                <div class="stars">
                  {{$r := .Rating}}
                  {{range iterate 5}}
                  {{if le . $r}}<i class="bi bi-star-fill"></i>{{else}}<i class="bi bi-star"></i>{{end}}
                  {{end}}
                </div>
              </div>
              <p class="text-muted small mb-1">{{.Comment}}</p>
              <small class="text-muted">{{.CreatedAt.Format "Jan 02, 2006"}}</small>
            </div>
          </div>
          {{end}}
        </div>
        {{else}}
        <p class="text-muted small mb-4">No reviews yet. Be the first to review!</p>
        {{end}}

        <!-- Submit Review -->
        {{if .Session}}{{if .Event.UserBooked}}
        <div class="border-top pt-3">
          <h6 class="fw-600 mb-3">Write a Review</h6>
          <form method="POST" action="/user/review">
            <input type="hidden" name="event_id" value="{{.Event.ID}}">
            <div class="mb-3">
              <label class="form-label small fw-500">Rating</label>
              <select class="form-control" name="rating" required>
                <option value="">Select rating</option>
                <option value="5">⭐⭐⭐⭐⭐ Excellent</option>
                <option value="4">⭐⭐⭐⭐ Good</option>
                <option value="3">⭐⭐⭐ Average</option>
                <option value="2">⭐⭐ Poor</option>
                <option value="1">⭐ Terrible</option>
              </select>
            </div>
            <div class="mb-3">
              <textarea class="form-control" name="comment" rows="3" placeholder="Share your experience..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-sm"><i class="bi bi-send me-1"></i>Submit Review</button>
          </form>
        </div>
        {{end}}{{end}}
      </div>
    </div>

    <!-- Booking Sidebar -->
    <div class="col-lg-4">
      <div class="booking-form">
        <div class="text-center mb-4">
          <div class="fs-3 fw-800 text-primary">{{formatPrice .Event.Price}}</div>
          <div class="text-muted small">per ticket</div>
        </div>

        {{if .Event.UserBooked}}
        <div class="alert alert-success text-center mb-3">
          <i class="bi bi-check-circle-fill me-2"></i>You've booked this event!
        </div>
        <a href="/user/bookings" class="btn btn-outline-primary w-100">View My Bookings</a>

        {{else if eq .Event.Status "approved"}}
        {{if .Session}}
        {{if eq .Session.Role "user"}}
        <form method="POST" action="/user/book">
          <input type="hidden" name="event_id" value="{{.Event.ID}}">
          <div class="mb-3">
            <label class="form-label small fw-500">Number of Tickets</label>
            <input type="number" class="form-control" name="tickets" value="1" min="1" max="10" required>
          </div>
          <div class="mb-3">
            <label class="form-label small fw-500">Notes (optional)</label>
            <textarea class="form-control" name="notes" rows="2" placeholder="Any special requests?"></textarea>
          </div>
          <button type="submit" class="btn btn-primary w-100"><i class="bi bi-ticket-perforated me-2"></i>Book Now</button>
        </form>
        {{else}}
        <div class="alert alert-info small text-center">Login as a user to book</div>
        {{end}}
        {{else}}
        <a href="/login" class="btn btn-primary w-100 mb-2"><i class="bi bi-person me-2"></i>Login to Book</a>
        <a href="/register" class="btn btn-outline-primary w-100">Create Account</a>
        {{end}}
        {{else}}
        <div class="alert alert-secondary text-center">This event is not available for booking</div>
        {{end}}

        <hr>
        <div class="text-muted small">
          <div class="d-flex justify-content-between mb-1"><span>Status</span><span class="badge bg-success">{{.Event.Status}}</span></div>
          {{if gt .Event.Capacity 0}}<div class="d-flex justify-content-between mb-1"><span>Available</span><span class="fw-500">{{sub .Event.Capacity .Event.BookingCount}} spots</span></div>{{end}}
          <div class="d-flex justify-content-between"><span>Organizer</span><span class="fw-500">{{.Event.OrganizerName}}</span></div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
{{end}}
